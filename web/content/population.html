<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Population</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <style>
        th, td, p, input {
            font:14px Verdana;
        }
        table, th, td {
            border: solid 1px #DDD;
            border-collapse: collapse;
            padding: 2px 3px;
            text-align: center;
        }
        th {
            font-weight: bold;
        }
    </style>
    <ul>
        <li><a href="countries.html">countries</a></li>
        <li><a href="capitals.html">capitals</a></li>
        <li><a href="language.html">language</a></li>
        <li><a href="population.html">population</a></li>
        <li><a href="cities.html">cities</a></li>
    </ul>
</head>
<body>
<div class="showData">Loading data...</div>

<script>
    var urlParams = new URLSearchParams(window.location.search);
    const continent = urlParams.get('continent');
    const region = urlParams.get('region');
    const country = urlParams.get('country');

    var URL = "http://" + window.location.hostname + "/app/population";

    let queryParams = []

    if (continent) {
        queryParams.push("continent=" + encodeURIComponent(continent));
    }
    if (region) {
        queryParams.push("region=" + encodeURIComponent(region));
    }
    if (country) {
        queryParams.push("country=" + encodeURIComponent(country));
    }

    if (queryParams.length > 0) {
    URL += "?" + queryParams.join("&");
    }


    $.getJSON(URL, function(data) {
        var col = [];
        for (var i = 0; i < data.length; i++) {
            for (var key in data[i]) {
                if (col.indexOf(key) === -1) {
                    col.push(key);
                }
            }
        }

        var table = document.createElement("table");
        var tr = table.insertRow(-1);

        for (var i = 0; i < col.length; i++) {
            var th = document.createElement("th");
            th.innerHTML = col[i];
            tr.appendChild(th);
        }

        for (var i = 0; i < data.length; i++) {
            tr = table.insertRow(-1);
            for (var j = 0; j < col.length; j++) {
                var tabCell = tr.insertCell(-1);
                tabCell.innerHTML = data[i][col[j]];
            }
        }

        $(".showData").html(table);
    }).fail(function() {
        $(".showData").html("<p>Failed to load data from backend.</p>");
    });
</script>
</body>
</html>
